<div align="center">

# Visual Prompt Gallery (EXIF)

<img src="../assets/visual_prompt_gallery_(exif)_preview.gif" width="100%" alt="Visual Prompt Gallery Interface">

**Your personal asset browser inside ComfyUI**

<sup>Category: `utils`</sup>

[Gallery Interface](#gallery-interface) | [Importing Images](#importing-images) | [Metadata Extraction](#supported-metadata) | [Settings](#settings)

</div>

---

> [!WARNING]
> **Incompatibility with ComfyUI Nodes 2.0**
>
> This node currently relies on the standard LiteGraph interface. It **will not render** if you have enabled the experimental "Nodes 2.0" (Vue-based) frontend in ComfyUI settings. Please disable the new frontend to use the Gallery.

---

 ## Overview

The Visual Prompt Gallery is an integrated image browser that lives within your ComfyUI workflow. It stores reference images, automatically extracts generation metadata, and outputs prompts ready to use.

<table>
<tr>
<td width="50%" valign="top">

### What You Can Do

- **Browse** your reference images visually
- **Extract** prompts from image metadata
- **Switch** styles with a single click
- **Store** inspiration directly in your workflow

</td>
<td width="50%" valign="top">

### Why It Matters

Instead of:
- Switching to file explorer
- Opening images in external apps
- Copying prompts manually
- Losing track of what settings worked

**Everything stays in ComfyUI.**

</td>
</tr>
</table>

---

## Getting Started

### **Step 1:** Add the Node

Right-click canvas → `Add Node` → `utils` → **Visual Prompt Gallery (EXIF)**

### **Step 2:** Import Images

Drag and drop images from your file system directly onto the node.

### **Step 3:** Connect Outputs

Connect the `positive_prompt` and `negative_prompt` outputs to your text encoding nodes.

### **Step 4:** Select and Generate

Click an image in the gallery → Run your workflow → Prompts are automatically populated.

---

## Gallery Interface

### Main Elements

| Element | Description |
|---------|-------------|
| **Thumbnail Grid** | Visual display of all stored images |
| **Selection Highlight** | Currently selected image has a border |
| **Hover Tooltip** | Shows "Click to load Metadata" hint |
| **Prompt Fields** | Extracted positive/negative prompts |

### Mouse Controls

| Action | Result |
|--------|--------|
| <kbd>Left Click</kbd> | Select image, load metadata |
| <kbd>Right Click</kbd> | Open context menu |
| <kbd>Drag & Drop</kbd> | Import new images |

### Context Menu Options

| Option | Description |
|--------|-------------|
| **View Fullscreen** | Open image in fullscreen viewer |
| **Remove from Gallery** | Delete image from gallery storage |

### Fullscreen Viewer

- Click anywhere or press <kbd>Esc</kbd> to close
- View images at full resolution
- Examine details before committing to a style

---

## Importing Images

### Drag and Drop

The simplest method - drag images directly from:
- File Explorer (Windows)
- Finder (macOS)
- Any file manager (Linux)

Images are automatically copied to storage.

### Storage Location

```
ComfyUI/
└── input/
    └── visual_gallery/
        ├── image_001.png
        ├── image_002.jpg
        └── ...
```

> **Note:** Images are stored locally. They remain available across ComfyUI sessions.

### Supported Formats

| Format | Extension | Notes |
|--------|-----------|-------|
| PNG | `.png` | Best for metadata preservation |
| JPEG | `.jpg`, `.jpeg` | EXIF metadata supported |
| WebP | `.webp` | Limited metadata support |

---

## Supported Metadata

The gallery extracts prompts from multiple metadata formats automatically.

### Format Priority

The extraction system checks these sources in order:

| Priority | Source | Description |
|:--------:|--------|-------------|
| 1 | **EXIF UserComment** | Standard EXIF field |
| 2 | **CivitAI Format** | `extraMetadata` JSON |
| 3 | **A1111 Format** | `parameters` field |
| 4 | **InvokeAI Format** | `sd-metadata` JSON |
| 5 | **PNG tEXt Chunks** | ComfyUI workflow data (Fallback) |

### ComfyUI / PNG Chunks

Images generated by ComfyUI embed workflow data in PNG chunks:

```json
{
  "prompt": { ... },
  "workflow": { ... }
}
```

The gallery parses these to extract text prompts from CLIP nodes.

### Automatic 1111 / Forge Format

Standard format used by Automatic1111 and Forge:

```
beautiful landscape, mountains, sunset
Negative prompt: ugly, blurry, low quality
Steps: 20, Sampler: Euler, CFG scale: 7
```

The gallery splits on "Negative prompt:" to separate positive/negative.

### CivitAI Format

Images downloaded from CivitAI may contain:

```json
{
  "extraMetadata": {
    "prompt": "...",
    "negativePrompt": "..."
  }
}
```

### EXIF UserComment

Generic EXIF field used by various tools. The gallery attempts to parse JSON or plain text.

---

## Settings

### Aspect Ratio Modes

Toggle between thumbnail display modes:

| Mode | Aspect | Best For |
|------|:------:|----------|
| **Square** | 1:1 | Mixed content |
| **Portrait** | 0.68:1 | Character art |
| **Landscape** | 1.46:1 | Scenery, backgrounds |

### Gallery Sizing

The gallery window is resizable. Drag edges or corners to adjust.

---

## Outputs

| Output | Type | Description |
|--------|------|-------------|
| `IMAGE` | IMAGE | Selected image as tensor (64x64 fallback if none selected) |
| `positive_prompt` | STRING | Extracted positive prompt text |
| `negative_prompt` | STRING | Extracted negative prompt text |

---

## Workflow Tips

### Building a Style Library

1. Generate images with different styles/settings
2. Save the ones you like
3. Drag them into the Visual Prompt Gallery
4. Click to instantly recall those prompts

### Quick A/B Testing

1. Import multiple reference images
2. Click between them to swap prompts
3. Compare results with identical seeds

### Prompt Editing

The extracted prompts appear in editable text fields. You can:
- Modify them before generation
- Combine elements from different references
- Use them as starting points

---

## Offline Operation

The gallery uses the **ExifReader** JavaScript library for metadata parsing.

| State | Behavior |
|-------|----------|
| **First Load** | Library downloaded from CDN |
| **Subsequent Loads** | Library served from browser cache |
| **Offline** | Works if library was previously cached |

> **Privacy:** No image data is sent externally. All processing happens locally.

---

## Related Documentation

- [Troubleshooting](./TROUBLESHOOTING.md) - Common issues and solutions
- [Back to Main Documentation](../readme.md)
